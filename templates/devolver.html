{% extends 'base.html' %}

{% block title %}Registrar Devolução — Biblioteca{% endblock %}

{% block content %}
  <h2>Devolução</h2>
  <form class="form-card" action="/devolver" method="post">
    <input name="matricula" placeholder="Matrícula do Leitor">
    <input name="isbn" placeholder="ISBN do Livro">
    <input type="date" name="data_real">

    <div class="actions">
      <button class="btn primary" type="submit">Registrar Devolução</button>
      <a class="btn" href="/">Voltar</a>
    </div>
  </form>
{% endblock %}

{% block scripts %}
<script>
  (function(){
    const form = document.querySelector('form');
    const error = document.createElement('div');
    error.className = 'form-error';
    form.insertBefore(error, form.firstChild);

    form.addEventListener('submit', function(e){
      error.style.display='none'; error.textContent='';
      form.querySelectorAll('.input-invalid').forEach(i=> i.classList.remove('input-invalid'));
      const mat = form.querySelector('input[name="matricula"]');
      const isbn = form.querySelector('input[name="isbn"]');
      const data = form.querySelector('input[name="data_real"]');
      const problems = [];
      if(!mat.value.trim()){ problems.push('Informe a matrícula do leitor'); mat.classList.add('input-invalid') }
      if(!isbn.value.trim()){ problems.push('Informe o ISBN do livro'); isbn.classList.add('input-invalid') }
      if(!data.value.trim()){ problems.push('Informe a data da devolução'); data.classList.add('input-invalid') }
      if(problems.length){ e.preventDefault(); error.innerHTML = problems.map(p=>`<div>• ${p}</div>`).join(''); error.style.display='block'; error.scrollIntoView({behavior:'smooth', block:'center'}); }
    });
  })();
</script>
{% endblock %}
